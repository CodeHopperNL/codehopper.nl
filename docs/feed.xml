<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.1.2">Jekyll</generator><link href="https://codehopper.nl/feed.xml" rel="self" type="application/atom+xml" /><link href="https://codehopper.nl/" rel="alternate" type="text/html" /><updated>2017-05-21T22:05:53+02:00</updated><id>https://codehopper.nl/</id><title>CodeHopper</title><subtitle>Software and technology done right</subtitle><entry><title>Void methods as behavior black holes</title><link href="https://codehopper.nl/2017/01/24/void-methods-as-behavior-black-holes/" rel="alternate" type="text/html" title="Void methods as behavior black holes" /><published>2017-01-24T00:00:00+01:00</published><updated>2017-01-24T00:00:00+01:00</updated><id>https://codehopper.nl/2017/01/24/void-methods-as-behavior-black-holes</id><content type="html" xml:base="https://codehopper.nl/2017/01/24/void-methods-as-behavior-black-holes/">&gt; This post could have been titled &#39;Void methods considered harmful&#39;,
&gt; if &#39;considered harmful&#39; essays weren&#39;t
&gt; [considered harmful themselves][considered harmful]. Oh welp.

Void methods are ubiquitous in most Object Oriented codebases. A
direct consequence of mutable state or I/O somewhere in your runtime,
you can wrap any behavior that functional programming zealots would
call [impure][impure], which in principle has no meaningful return
value. One common example is during application bootstrap, e.g. in
Java:

```java
@Resource MyClass implements Runnable {

// ...

@PostConstruct
public void init() {
    if(this.enabled) {
        this.executorService.scheduleAtFixedRate(
            this,
            0,
            500,
            TimeOut.MILLISECONDS);
    }
}

// ...
}
```

The above is supposedly fine, but public void methods, and especially
a proliferation of them in a given codebase, are an evident code
smell. Even when coding in Object Oriented style.

# Your `public` interface

Public methods are meant for your class [collaborators][CRC] to
consume, they are the gateway to your class functionality. As such,
they should be as clear as concise as possible, offering the minimal
surface area needed to enable your class behaviors. One major,
self-documenting part of any function definition is naturally its
return type.

Lets start from the previous example:

```java
@Resource MyClass implements Runnable {

// ...

@PostConstruct
public void init() {
    if(this.enabled) {
        this.executorService.scheduleAtFixedRate(
            this,
            0,
            500,
            TimeOut.MILLISECONDS);
    }
}

// ...
}
```

Our class is likely receiving some sort of `executorService` instance
at construction time, possibly obtained from some
[dependency injection][magic] glue code, after which a worker schedule
is started. The likelihood of client code needing to explicitly call
`init()` is typically very low. This suggests that our
`@PostConstruct` method should probably have a more restrictive
visibility, maybe `private` or `protected`, and that would be the end
of it.

But, is it really?

# Testability

Let&#39;s say we want to actually test the shutdown
behavior of our worker threads, typically a tricky thing to do. What
you want to do is something along the lines of:

``` java

// changed code from the original MyClass file:
@PostConstruct
public ScheduledFuture&lt;T&gt; init() {
    if(this.enabled) {
        return this.executorService.scheduleAtFixedRate(
            this,
            0,
            500,
            TimeOut.MILLISECONDS);
    }
}


public testExecutorShutdown(){
    ScheduledExecutorService service = Executors.newSingleThreadScheduledExecutor();
    MyClass c = new MyClass(service, true); // executorService, enabled
    ScheduledFuture&lt;T&gt; scheduled = c.init();
    executorService.shutdown();
    scheduled.get(1, TimeUnit.SECONDS); // throws exception
}
```

The above test code tests that the scheduled action terminates within
1 second (or two scheduled iterations) from the executor
shutdown. Such a test relies on accessing the future object returned
by the init method.

# Self documenting

&gt; it is Human perception that is sealed off behind their current consciousness horizon
&gt;
&gt; -- *Elia Wise*

The change we made to the `init()` method enabled the behavioral test,
but introduced an important side effect: the `ScheduledFuture` object
is now part of `MyClass` public interface, meaning that now any client
code is able to interact with it. Whether this is a desirable property
really depends on the use case `MyClass` is designed to support, and
probably you want to encapsulate the `ScheduledFuture` in a more
friendly class that e.g. only exposes something like `bool
isDone()`.

In any case, keeping the above `init` method void would always end up
in your client code (or developer glancing at the `init` signature
using his/her IDE) being oblivious of what `MyClass.init()` is really
doing. Just look at the different signatures, and think of yourself
coding against each of them:

``` java
public void init()
public ScheduledFuture&lt;T&gt; init()
```

the latter one will save you a brain cycle every time you need to use
it, as it clearly states its produced effects without having to look
at the code or at a deeper level of documentation.

# Do one thing and do it well

Sticking to the idea that your function returns a single value to
explicitly states its behavior is obviously impossible when your
function does more than one thing at a time. Fortunately, that by
itself is a [code smell][single responsibility], and by treating your
return type as the existential purpose of your functions you make it
one step weirder to violate the principle.

# Conclusions

Be nice to your future self and in general to all developers using
your code and never hide such a valuable piece of information like
your return value in your public API, never again.

Hugs &amp; kisses,
c.

[impure]: https://en.wikipedia.org/wiki/Pure_function#Impure_functions_in_pure_expressions
[magic]: http://imgur.com/iZcUNxH
[considered harmful]: http://meyerweb.com/eric/comment/chech.html
[CRC]: https://en.wikipedia.org/wiki/Class-responsibility-collaboration_card
[single responsibility]: https://en.wikipedia.org/wiki/Single_responsibility_principle</content><category term="java" /><category term="clean code" /><summary>This post could have been titled ‘Void methods considered harmful’,
if ‘considered harmful’ essays weren’t
considered harmful themselves. Oh welp.</summary></entry><entry><title>Yet another agile is dead post</title><link href="https://codehopper.nl/2016/12/05/yet-another-agile-is-dead-post/" rel="alternate" type="text/html" title="Yet another agile is dead post" /><published>2016-12-05T00:00:00+01:00</published><updated>2016-12-05T00:00:00+01:00</updated><id>https://codehopper.nl/2016/12/05/yet-another-agile-is-dead-post</id><content type="html" xml:base="https://codehopper.nl/2016/12/05/yet-another-agile-is-dead-post/">Say you are in the software business for a while, and you worked with many different
organizations on software projects. Say all of them adopted an agile process,
and you had more than your fair share of standups, burndowns, sprints, release
trains and stuff. Now, say someone asks you to draw a picture of **#agile**,
will that be like this?

![simple agile](/img/post/wheel.png)

No. Effing. Way.

## Agile is dead

I&#39;m by far not the first one on the [agile is dead bangwagon][agile-is-dead].
There is a practically infinite corpus citing how agile is broken, whether because
it lends itself to [oversimplifying our profession][overly-simple] or because it&#39;s
just a [hype come to its end][hype-cycle].

Set aside all the good intentions
and [compelling ethics][agile-manifesto], Agile became way too meta for it to be
any good to anyone. In search for the exact science of process management, people
thought it was in the best interest of everyone to create standards over standards
of supposedly battle-proven methodologies.

This is what we actually got ([*image courtesy of Deloitte*][deloitte]):

![real agile](/img/post/agile-landscape.jpg)

The author of this complex diagram was trying to shed some light on the current
plethora of Agile methodologies that people have been implementing, and while
the result is horrifying from anyone interested into Getting Things Done, it&#39;s
spot on the very issue we have at hand: there is no exact science of management.
We, as a whole industry, should be get over it already.

## Long live agile

I believe we&#39;re now at the Agile [antithesis][antithesis]. The [hype cycle][hype-cycle]
is now at the end of the Disillusionment deep, and already getting into
Productivity. The [gospel][agile-manifesto] has been introspected and it&#39;s
simply not a thing to speak of agile anymore.

Eventually, we&#39;re in the [post-agile][post-agile]
era already, and we need our IT managers to truly understand what they role
really is, we need them to do their job and understand where the agile script
works, where it doesn&#39;t and ultimately where it enables the whole organization
to really work as it should.

Amen.


[deloitte]: http://blog.deloitte.com.au/agile/2016/03/07/navigating-the-agile-landscape/#.WEbfLqIrLdQ
[agile-is-dead]: https://www.google.nl/search?q=agile%20is%20dead
[overly-simple]: https://effectivesoftwaredesign.com/2014/03/17/the-end-of-agile-death-by-over-simplification/
[hype-cycle]: https://www.linkedin.com/pulse/agile-hype-cycle-matthew-kern-msea-cea-pmp-itil-cissp-issap?trk=mp-reader-card
[agile-manifesto]: http://agilemanifesto.org/
[antithesis]: https://en.wikipedia.org/wiki/Antithesis#Hegel_and_antithesis
[hype-cycle]: https://en.wikipedia.org/wiki/Hype_cycle
[post-agile]: https://www.google.nl/search?q=post%20agile</content><category term="agile" /><summary>Say you are in the software business for a while, and you worked with many different
organizations on software projects. Say all of them adopted an agile process,
and you had more than your fair share of standups, burndowns, sprints, release
trains and stuff. Now, say someone asks you to draw a picture of #agile,
will that be like this?</summary></entry><entry><title>Dear future me</title><link href="https://codehopper.nl/2016/01/10/a-new-chapter/" rel="alternate" type="text/html" title="Dear future me" /><published>2016-01-10T00:00:00+01:00</published><updated>2016-01-10T00:00:00+01:00</updated><id>https://codehopper.nl/2016/01/10/a-new-chapter</id><content type="html" xml:base="https://codehopper.nl/2016/01/10/a-new-chapter/">&gt; NOTE: these are the words that I wrote to myself on October 31st 2016, the day
&gt; in which I left my then-current company. The piece was written with the intent
&gt; of being published, in case people who regard my opinion (future me hopefully included)
&gt; on working things can
&gt; have a look at how I reflect on my own decisions. Happy reading!


**Dear future me**,

here&#39;s you at the very end of your experience at Sytac.

Yes, you multiple personalities weirdo.

As of today you are not anymore on office as the CTO of [Sytac](http://www.sytac.nl),
the IT consulting company you&#39;ve part of in the last two years. As your memory is proverbially
awful, I hope these notes will give you a better perspective on how you feel
at the moment, surely a better one than what you *think* you had.

# On leaving

Yes, you quitter.

It&#39;s not the first time you leave colleagues you loved behind,
and you firmly believe that either you are part of the solution, or you are part
of the problem. Yet to leave is like declaring to the general public that you
believe to be part of the problem, so what&#39;s up with that?

Well, that&#39;s true. With all your ideas and suggestions and big mouth and stuff,
you weren&#39;t able to fix the problems that always bothered you, making you 100%
part of the problem, certified. Deep inside you almost always knew that you
were not cut for leading Sytac to revolutionize itself on your terms, and maybe
that was even a foolish thing to hope for in the first place.

Yet, you wanted to believe and ran circles *around* the main issues without facing the
biggest obstacles first. You feared you would have crushed on them anyway.

So yes, better leave and give way to the new. But remember: next time, face the
biggest issues first, or else you might find yourself wasting precious time
chasing windmills.

# On career

Yes, your ego.

As pretty much everyone that ever wrote some software, you have a big
thirst for the alpha-nerd recognition. You did prove yourself here, so much that
you earned the C level. That was a morality booster for you, wasn&#39;t it?

The thing is, for you the most important part of getting up the ladder is to
prove yourself that you are capable of handling the bigger headaches that any
new accomplishment comes with. One step up, and you take due note that ok, that
is something you can do if you want. You fed your ego enough, time to move on.

At this point you have evolved from an insecure, awkward nerd into an accomplished
professional who craves stage time and public attention. Your ego has inflated
enough, and at the moment you look at that CTO thingy more as an uncomfortable
position: if you are the top dog, who will you learn from?

But by now you know it all too well, that you care almost nothing for what step of
the ladder you occupy: do something great and do it good, that&#39;s what makes you
open your tail like a &lt;pavone&gt;.

# On having guts

Yes, you sissy.

Despite your quite evident issue of logorrhea, you missed many
occasions in which you could open your damn mouth when it really mattered. You
saw potential and you didn&#39;t fight to realize it. And you know why? You didn&#39;t
think you could win it. And maybe you could not, but that&#39;s beside the point.

Make sure you always try your best, and if you think that&#39;s not enough then be
open and admit failure. In software as in life, fail fast is always the best
option for everyone involved.

# On closing

Yes, you blatant fool, time to close this psycho letter.

The past two years have been an interesting journey, and you did grow personally
and professionally and you [did things](http://amsterdam2016.codemotionworld.com)
you never dreamt you could handle. And as you know yourself good enough, that can
only mean that bigger challenges are ahead.

Brace yourself, for the journey and keep your focus sharp on things that really
matter to you. But as you who read this is me in the future, you know that better
than me.

[Or do you?](https://en.wikipedia.org/wiki/Eternal_return)

A si biri in bon&#39;ora.</content><category term="real life" /><category term="sytac" /><summary>NOTE: these are the words that I wrote to myself on October 31st 2016, the day
in which I left my then-current company. The piece was written with the intent
of being published, in case people who regard my opinion (future me hopefully included)
on working things can
have a look at how I reflect on my own decisions. Happy reading!</summary></entry><entry><title>The best keyboard layout for Clojurists</title><link href="https://codehopper.nl/2015/03/01/colemak-best-keyboard-for-clojurists/" rel="alternate" type="text/html" title="The best keyboard layout for Clojurists" /><published>2015-03-01T00:00:00+01:00</published><updated>2015-03-01T00:00:00+01:00</updated><id>https://codehopper.nl/2015/03/01/colemak-best-keyboard-for-clojurists</id><content type="html" xml:base="https://codehopper.nl/2015/03/01/colemak-best-keyboard-for-clojurists/">Keyboards, oh my!
=================

If you&#39;re a programmer, you spend most of your working life on your keyboard, and a good keyboard layout can make the difference between touch typing and carpal syndrome.

That, and an irresistible drive for being the alpha nerd around, pushed me to teach myself [Colemak](http://colemak.com/).

It was painful and frustrating at the beginning, when I saw my typing speed precipitating from a respectable 80 words per minute to a horrific 20wpm. But now, now that touch typing has no mysteries for me on this mystical keyboard, now I got beyond my past self, recently crushing the 90wpm milestone. Hooray!

`(def best)`
============

In this data driven world, we constantly need to verify whether the decisions we make are still valid, and therefore the question: would Colemak be the best keyboard for me? Am I losing by sticking with the wrong choice? And would I be even willing to switch again keyboard layout in the foreseeable future?

While the answer to the last question is a roaring [&quot;NO!&quot;](http://images.sodahead.com/polls/003657975/125779928_Noooooooooooooooo_answer_1_xlarge.Peg), I needed to know. I needed data. But how?

Well, first things first, I type lots of [Groovy](http://groovy.codehaus.org/) and [Clojure](http://clojure.org/) these days. But I don&#39;t care for the former language, my heart is really about my dear lispy friend. I just had to find a way to produce an automatic comparison, surely enough, here it is: the [Keyboard Layout Analyzer](http://patorjk.com/keyboard-layout-analyzer/), courtesy of [Patrick Gillespie](http://patorjk.com/).

I love the Internet.

The winner is..
===============

Aaaaand here it is: a comparative analysis of what keyboard is the best for Clojure Developers&amp;#8482;, after feeding the analyzer with [`clojure/core.clj`](https://github.com/clojure/clojure/blob/master/src/clj/clojure/core.clj), with its impressive 7447 lines of code:

![Test results](/img/post/colemak_clj.png)

Now you know. Now it&#39;s official.

Happy touch typing, everyone!

p.s.: you can read the details of the comparison [here](http://patorjk.com/keyboard-layout-analyzer/#/load/D40PQ0hB)</content><category term="clojure" /><category term="keyboard" /><category term="colemak" /><summary>Keyboards, oh my!</summary></entry><entry><title>Spring Environment is for initialization code only</title><link href="https://codehopper.nl/2015/01/31/spring-environment-only-for-init/" rel="alternate" type="text/html" title="Spring Environment is for initialization code only" /><published>2015-01-31T00:00:00+01:00</published><updated>2015-01-31T00:00:00+01:00</updated><id>https://codehopper.nl/2015/01/31/spring-environment-only-for-init</id><content type="html" xml:base="https://codehopper.nl/2015/01/31/spring-environment-only-for-init/">Since version 3.1, the [Spring framework](https://spring.io/) offers an abstraction towards several different
sources through which you can easily configure your application: the [``Environment``](http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/Environment.html).

In this post I describe a micro benchmark that I ran to prove that, while it&#39;s a convenient API if you&#39;re
using Spring in your application, it might introduce a performance penalty for which you should not use it
outside of your initialization code.

How it works
============

Before getting into the numbers, a quick digression on the internals of the ``Environment`` that are important
to this post.

From the documentation:

&gt;&gt; _Properties play an important role in almost all applications, and may originate from a variety of sources: properties files, JVM system properties, system environment variables, JNDI, servlet context parameters, ad-hoc Properties objects, Maps, and so on. The role of the environment object with relation to properties is to provide the user with a convenient service interface for configuring property sources and resolving properties from them._

So, you can use the ``Environment`` to have a common interface to properties provided with different strategies, using
a simple ``getProperty`` call to access the required value. Look at the following Groovy code:

```java
    @Component
    public class Greeter {

        private Environment environment

        @Autowired
        public Greeter greeter(Environment environment){
            this.environment = environment
        }

        def nickName(user) {
            environment.getProperty(&quot;user&quot;) // here be magic
        }

        def greet(user) {
            def nick = nickName(user)
            if (name == null) println &quot;Hi, ${user}!&quot;
                         else println &quot;Hi, ${nick}!&quot;
        }

    }
```

Now, I can specify nicknames in a properties file so that I can greet know users with a more familiar nick name,
still being able to salute also users which are not given a nickname. Neat, but how about performance?

The hidden Exception
====================

I got into this exercise while debugging a couple of slow pages in the website I&#39;m working on: the
[destinations pages](http://www.klm.com/destinations/nl/en/search) of the KLM main site. While performance is generally
satisfactory, two pages were constantly giving above second response times. Definitely [too much](http://www.vm.ibm.com/devpages/jelliott/evrrt.html).

In our code, we were translating some country names into queriable keys for an external services. We also needed to override
an otherwise straightforward translation algorithm with very specific exceptions to the rule. The actual code was pretty much
like the above ``Greeter.greet(user)``, and a [Flight Recorder](http://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/run.htm) session
eventually provided us with the performance bottleneck (click to open):

&lt;a href=&quot;/img/post/exceptions.png&quot;&gt;&lt;img style=&quot;width: 500px&quot; src=&quot;/img/post/exceptions.png&quot; /&gt;&lt;/a&gt;

For 12 page refreshes we were silently throwing 140k+ exceptions. And exceptions are
[sloooooow](http://java-performance.info/throwing-an-exception-in-java-is-very-slow/), even if you just create them.

Looking at the top thrown exception, it was actually pretty
easy to understand what&#39;s going on: the ``Environment`` checks whether the requested property is defined in the current JNDI context. But, if the
name is not found, a [``NameNotFoundException``](http://docs.oracle.com/javase/8/docs/api/javax/naming/NameNotFoundException.html) is thrown. In our specific case we were using property lookup for *exceptional* cases,
which means the vast majority of cases resulted in an exception being thrown.

Micro benchmark
===============

I put together a [micro benchmark](https://gist.github.com/skuro/648cf1d871d203a73a0c) to evaluate the potential performance gain
of the original property lookup strategy versus a simpler one where relevant properties are loaded up at class construction time. I used the
[Java Microbenchmark Harness](http://openjdk.java.net/projects/code-tools/jmh/), which does an incredible job at making micro benchmarks
easy on the JVM: JIT, warm up, class loading, all is taken care of for you and you can just go ahead and put your code under test. Here the results
(higher numbers better):

&gt;&gt; [Property lookup per invocation]
&gt;&gt;
&gt;&gt; Result: 28917.876 ?(99.9%) 183.630 ops/s [Average] &lt;br /&gt;
&gt;&gt; Statistics: (min, avg, max) = (25688.067, 28917.876, 30976.876), stdev = 777.500 &lt;br /&gt;
&gt;&gt; **Confidence interval (99.9%): [28734.246, 29101.505]**

----

&gt;&gt; [Property loading at class construction]
&gt;&gt;
&gt;&gt; Result: 159062.900 ?(99.9%) 1013.309 ops/s [Average] &lt;br /&gt;
&gt;&gt; Statistics: (min, avg, max) = (138707.926, 159062.900, 177183.549), stdev = 4290.413 &lt;br /&gt;
&gt;&gt; **Confidence interval (99.9%): [158049.591, 160076.209]**

As expected, five times as fast.

Conclusions
===========

I&#39;m not a big fan of Spring, but if you&#39;re using it the ``Environment`` class is a dead easy interface to your application configuration. But,
unless you&#39;re using JNDI as your main store of configuration  properties,
its performance characteristics make it a great tool only if you&#39;re using it in your initialization code, and not during on-line processing of
requests.</content><category term="java" /><category term="performance" /><summary>Since version 3.1, the Spring framework offers an abstraction towards several different
sources through which you can easily configure your application: the Environment.</summary></entry><entry><title>Alfresco H2 support releases and versioning scheme</title><link href="https://codehopper.nl/2014/07/06/alfresco-h2-support-new-releases-version-scheme/" rel="alternate" type="text/html" title="Alfresco H2 support releases and versioning scheme" /><published>2014-07-06T00:00:00+02:00</published><updated>2014-07-06T00:00:00+02:00</updated><id>https://codehopper.nl/2014/07/06/alfresco-h2-support-new-releases-version-scheme</id><content type="html" xml:base="https://codehopper.nl/2014/07/06/alfresco-h2-support-new-releases-version-scheme/">Some time has passed since the [last releases](/2013/03/27/h2-support-for-alfresco-3-4-12-and-maven/), and all the merits go once again to our dear [John Evans](http://springyweb.com/) from [Ixxus](http://www.ixxus.com/). Let&#39;s see what&#39;s new in the project.

Lots of releases, now with a new version scheme!
================================================

We were lagging behind Alfresco releases quite a bit, so you now have quite some [new releases](https://github.com/skuro/alfresco-h2-support/wiki/H2-Database-support-for-Alfresco) to look at. Most importantly, starting with Alfresco 4.2.0 we decided to align H2 Support with the official Alfresco versioning. So, while H2 Support v1.7 and v1.8 are the ones to be used respectively with Alfresco Enterprise 4.1.5 and 4.1.6, you will easily guess what versions of Alfresco Enterprise will have to use H2 Support v4.2.0 and v4.2.1.

Say your Alfresco v4.2.0 project is based on the [maven archetypes](https://code.google.com/p/maven-alfresco-archetypes/) (and shame on you if it&#39;s not), then you could simply override the following ``&lt;property&gt;`` in your pom:


{% highlight xml %}
    &lt;h2-support.version&gt;${alfresco.version}&lt;/h2-support.version&gt; &lt;!-- WARN WARN WARN!! --&gt;
{% endhighlight %}

Neah huh? But there&#39;s a big ``WARN`` sign in there, why&#39;s that?

Say the release of H2 Support is broken in any way (in theory it should never happen, but in practice it might happen). Then it might be a bit unfortunate if your poms rely on H2 Support and Alfresco to have exactly the same version. So, while the above should work in most cases, the preferred way to include H2 Support in your project is still as follows:

{% highlight xml %}
    &lt;h2-support.version&gt;4.2.0&lt;/h2-support.version&gt; &lt;!-- much better! --&gt;
{% endhighlight %}

Plans for the future
====================

In the future we plan to have a different strategy to bring H2 Support for Alfresco. Currently, we simply copy all the PostgreSQL in an H2 friendly package, so that the internal Alfresco machinery will automatically find them. Then, H2 compatibility mode is used to make the PostgreSQL dialect understood by the H2 driver. That&#39;s obviously suboptimal, and we will research methods to skip shuffling files around, but rather override the Alfresco SQL files locator strategy. The new strategy should provide a better integration with any Alfresco release, and we might very well need not new H2 Support releases per Alfresco version.

If you&#39;d like to help us realizing this integration sweet spot, you&#39;re so much welcome to joink the H2 Support crew!</content><category term="alfresco" /><category term="alm" /><category term="h2-support" /><category term="maven" /><summary>Some time has passed since the last releases, and all the merits go once again to our dear John Evans from Ixxus. Let’s see what’s new in the project.</summary></entry><entry><title>SeedUML, an online PlantUML editor</title><link href="https://codehopper.nl/2014/02/09/seeduml-an-online-plantuml-editor/" rel="alternate" type="text/html" title="SeedUML, an online PlantUML editor" /><published>2014-02-09T00:00:00+01:00</published><updated>2014-02-09T00:00:00+01:00</updated><id>https://codehopper.nl/2014/02/09/seeduml-an-online-plantuml-editor</id><content type="html" xml:base="https://codehopper.nl/2014/02/09/seeduml-an-online-plantuml-editor/">Finally online
==============

It&#39;s my pleasure to announce the availability of [SeedUML](http://seeduml.com), the online editor for UML diagrams based on the great [PlantUML language](http://plantuml.sourceforge.net/).

As it&#39;s in its early beta stages, I&#39;m sure you&#39;ll find some rough edges here and there, but there&#39;s some great and useful features I&#39;m sure you&#39;ll love. Especially if you&#39;re new to PlantUML, you&#39;ll find a damn easy way to create all sorts of UML diagrams, like [state](http://seeduml.com/GBK3c), [sequence](http://seeduml.com/Nmr0D), [class](http://seeduml.com/Jgfv9), etc, all with a crystal clear plain text description. The diagram updates as you type, and you can save the image for later use, or simply link it wherever you need it to show up.

Quick user guide
================

If you need an user guide, the site is itself not easy enough to use. But let&#39;s give a couple of pointers to start with:

- you need to start a new diagram, you go to [http://seeduml.com](http://seeduml.com)
- a random diagram ID is generated, and you&#39;ll be redirected to such diagram page (eg: [http://seeduml.com/GBK3c](http://seeduml.com/GBK3c))
- remember to bookmark the URL if the diagram is important, as there&#39;s no user save
- you follow PlantUML docs and create beautiful diagram
- whenever you need to edit the doc again, you go back to the same URL (you bookmarked it, right?)

Done. Easy, huh?

Disclaimer
==========

This is an **early beta**, use at your own risk (and pleasure, hopefully). Especially, don&#39;t expect to

- be guaranteed that your diagrams will stay there forever
- the service will be up and running at all times
- be able to save hidden diagrams
- have a rock solid syntax highlight
- etc etc etc

I will share some of the juicy technical details of that site later on on these pages, but for now, have fun and happy diagram authoring!</content><category term="seeduml" /><category term="uml" /><category term="design" /><category term="software" /><summary>Finally online</summary></entry><entry><title>H2 support 1.1.1 for Alfresco 3.4.12 Enterprise with Maven</title><link href="https://codehopper.nl/2013/03/27/h2-support-for-alfresco-3-4-12-and-maven/" rel="alternate" type="text/html" title="H2 support 1.1.1 for Alfresco 3.4.12 Enterprise with Maven" /><published>2013-03-27T00:00:00+01:00</published><updated>2013-03-27T00:00:00+01:00</updated><id>https://codehopper.nl/2013/03/27/h2-support-for-alfresco-3-4-12-and-maven</id><content type="html" xml:base="https://codehopper.nl/2013/03/27/h2-support-for-alfresco-3-4-12-and-maven/">Just a quick update on the [H2 support](https://github.com/skuro/alfresco-h2-support)
project, today I released the `1.1.1` maintenance version which targets
Alfresco v3.4.12 Enterprise.

Please make sure you always double check the [official documentation](https://github.com/skuro/alfresco-h2-support/wiki/H2-Database-support-for-Alfresco)
to pick and choose the right version to use in your Alfresco project.

H2 and Maven
============

For ~~the sane~~ those among you that use the [Maven SDK](https://artifacts.alfresco.com/nexus/content/repositories/alfresco-docs/alfresco-lifecycle-aggregator/latest/index.html),
you should know that `H2 support` is used to quickly boot the Alfresco repository
webapp during your development cycles.

If you&#39;re using a version of Alfresco other than the default 4.x that&#39;s assumed
by the SDK, you must also adapt your H2 support version to be able to start up
Alfresco. It&#39;s as easy as overriding the following maven property:

    &lt;h2-support.version&gt;1.1.1&lt;/h2-support.version&gt;

Happy development!</content><category term="alfresco" /><category term="h2support" /><category term="maven" /><category term="sonatype" /><summary>Just a quick update on the H2 support
project, today I released the 1.1.1 maintenance version which targets
Alfresco v3.4.12 Enterprise.</summary></entry><entry><title>Java StringBuilder myth debunked – now with content!</title><link href="https://codehopper.nl/2013/03/11/java-stringbuilder-myth-now-with-content/" rel="alternate" type="text/html" title="Java StringBuilder myth debunked -- now with content!" /><published>2013-03-11T00:00:00+01:00</published><updated>2013-03-11T00:00:00+01:00</updated><id>https://codehopper.nl/2013/03/11/java-stringbuilder-myth-now-with-content</id><content type="html" xml:base="https://codehopper.nl/2013/03/11/java-stringbuilder-myth-now-with-content/">The myth
========

&gt; Concatenating two Strings with the plus operator is the source of all evil
&gt;
&gt; -- Anonymous Java dev

***NOTE**: The source code for the tests discussed here can be found on [Github][github]*

It&#39;s from university time that I learned to regard `String` concatenation in Java
using the &#39;+&#39; plus operator as a deadly performance sin. Recently there has been
an internal review at [Backbase R&amp;D](http://www.backbase.com) where such recurring
mantra was dismissed as a myth due to `javac` using `StringBuilder` under the hood
any time you use the plus operator to join Strings. I set myself up to prove
such a point and verify the reality under different environments.

The test
========

Relying on your compiler to optimize your `String` concatenation means that things
might change heavily depending on the JDK vendor you adopt. As far as platform
support goes for my daily job, three main vendors should be considered:

* Oracle JDK
* IBM JDK
* ECJ -- for developers only

Moreover, while we officially support Java 5 through 6, we are also looking into
supporting Java 7 for our products, adding another three-folded level of indirection on top of
the three vendors. For the sake of &lt;del&gt;lazyness&lt;/del&gt; simplicity, the `ecj` compiled
bytecode will be run with a single JDK, namely Oracle JDK7.

I prepared a [Virtualbox](https://www.virtualbox.org/) VM with all the above JDK
installed, then I developed some classes to express three different concatenation
methods, amounting to three to four concatenations per method invocaiton,
depending on the specific test case.

The test classes are run a thousands times for each test round, with a total of
100 rounds each test case. The same VM is used to run all the rounds for the same
test case, and it&#39;s restarted across different test cases, all to let the Java
runtime perform all the optimizations it can, without affecting the other test
cases in any way. The default options were used to start all JVMs.

More details can be found in the benchmark runner [script](https://github.com/skuro/stringbuilder/blob/master/bench.sh).

The code
========

Full code for both test cases and the test suite is available on [Github][github].

The following different test cases were produced to measure performance
differences of the String concatenation with plus against the direct use of a
`StringBuilder`:

    // String concat with plus
    String result = &quot;const1&quot; + base;
    result = result + &quot;const2&quot;;

----

    // String concat with a StringBuilder
    new StringBuilder()
                  .append(&quot;const1&quot;)
                  .append(base)
                  .append(&quot;const2&quot;)
                  .append(append)
                  .toString();
    }

----

    //String concat with an initialized StringBuilder
    new StringBuilder(&quot;const1&quot;)
                  .append(base)
                  .append(&quot;const2&quot;)
                  .append(append)
                  .toString();

The general idea is to provide a concatenation both at the head and at the tail
of constant `String`s over a variable. The difference between the last two cases,
both making explicit use of `StringBuilder`, is in the latter using the 1-arg
constructor which initializes the builder with the initial part of the result.

The results
===========

Enough talking, down below here you can have a look at the generated graphs, where
each data point corresponds to a single test round (e.g. 1000 executions of the same
test class).

The discussion of the results and some more juicy details will follow.

![Concatenation with plus][catplus]
----
![Concatenation with StringBuilder][catsb]
----
![Concatenation with initialized StringBuilder][catsb2]

The discussion
==============

Oracle JKD5 is the clear loser here, appearing to be in a B league when compared
to the others. But that&#39;s not really the scope of this exercise, and thus we&#39;ll
gloss over it for the time being.

That said, there are two other interesting bits I observe in the above graph. The first is that indeed
there is generally quite a difference between the use of the plus operator vs an explicit
`StringBuilder`, *especially* if you&#39;re using Oracle Java5 which performs tree
times worse the the rest of the crew.

The second observation is that while it generally holds for most of the JDKs that
an explicit `StringBuilder` will offer up to twice the speed as the regular plus
operator, **IBM JDK6 seems not to suffer** from any performance loss, always averaging
25ms to complete the task in all test cases.

A closer look at the generated bytecode reveals some interesting details

The bytecode
============

***NOTE:** the decompiled classes are also available on [Github][github]*

Across all possible JDKs `StringBuilders` are **always** used to implement `String`
concatenation even in presence of a plus sign.
Moreover, across all vendors and versions, **there is almost no difference at all**
for the same test case. The only one that stands a bit apart is [`ecj`][ecjplus],
which is the only one to cleverly optimize the `CatPlus` test case to invoke
the 1-arg constructor of the `StringBuilder` instead of the 0-arg version.

Comparing the resulting bytecode exposes what could affect performance in the
different scnarios:

* when concatenating with plus, *new instances of `StringBuilder`* are created
any time a concatenation happens. This can easily result in a performance
degradation due to useless invocation of the constructor plus more stress on
the garbage collector due to throw away instances

* compilers will take you literally and only initalize `StringBuilder` with its
1-arg constructor if and only if you write it that way in the original code. This
results in respectively four and three invocations of `StringBuilder.append` for
[CatSB][catsbp] and [CatSB2][catsb2p].

The conclusion
==============

Bytecode analysis offers the final answer to the original question.

&gt; Do you need to explicitly use a `StringBuilder` to improve performance? **Yes**

The above graphs clearly show that, unless you&#39;re using IBM JDK6 runtime, you will
loss 50% performance when using the plus operator, although it&#39;s the one to perform
slightly worse across the candidates when expliciting `StringBuilder`s.

Also, it&#39;s quite interesting to see how *JIT optimizations* impact the overall
performance: for instance, even in presence of different bytecode between the two
explicit `StringBuilder` test cases, the end result is absolutely the same in the
long run.

![Myth confirmed][myth]

[catplus]: /img/post/catplus.png &quot;Concatenation with plus&quot;
[catsb]: /img/post/catsb.png &quot;Concatenation with StringBuilder&quot;
[catsb2]: /img/post/catsb2.png &quot;Concatenation with initalized StringBuilder&quot;
[github]: https://github.com/skuro/stringbuilder
[ecjplus]: https://github.com/skuro/stringbuilder/blob/master/ecj/CatPlus.class.txt
[catsbp]: https://github.com/skuro/stringbuilder/blob/master/ecj/CatSB.class.txt
[catsb2p]: https://github.com/skuro/stringbuilder/blob/master/ecj/CatSB2.class.txt
[myth]: /img/post/myth-confirmed.jpg</content><category term="java" /><category term="performance" /><category term="development" /><summary>The myth</summary></entry><entry><title>The Observer Pattern in Spring</title><link href="https://codehopper.nl/2013/03/10/observer-pattern-spring-framework/" rel="alternate" type="text/html" title="The Observer Pattern in Spring" /><published>2013-03-10T00:00:00+01:00</published><updated>2013-03-10T00:00:00+01:00</updated><id>https://codehopper.nl/2013/03/10/observer-pattern-spring-framework</id><content type="html" xml:base="https://codehopper.nl/2013/03/10/observer-pattern-spring-framework/">Observers in Spring
===================

&gt; To the man-in-the-street, who, I&#39;m sorry to say,  
&gt; Is a keen observer of life,  
&gt; The word &quot;Intellectual&quot; suggests straight away  
&gt; A man who&#39;s untrue to his wife.  
&gt;
&gt; -- W.H. Auden

The Observer pattern is a very basic one out of the GoF bible which is unbelivably easy to implement and still quote
powerful so use. Here I present my take on it using the Spring observer pattern which I found quite helpful in designing
extension points for my software.

Core classes
============

Pushing back the little NIH devil whispering in my ears, I started by reusing the standard building blocks for the
Observer pattern: `java.util.Observable` and `java.util.Observer`. The Observable class provides the logic to handle a
registry of Observers, and to propagate updates (I prefer to think more of in terms of events) to all of the registered
Observers.

In the context of a Spring container, there will be beans to configure and hook together, and it&#39;s key to this exercise
to find a flexible and handy way to connect things together.

Automatic registration
=====================

Supporting code for this blog post can be found on [GitHub](https://github.com/skuro/spring-observer).

When developing a Spring application you&#39;re always instantiating your classes as singletons within the Spring container.
Annotations or XML configurations will take care  of initialize instances of your classes, wiring them together in a
connected graph of objects with loose dependencies on the specific concrete classes you adopt in your code.

As you will always have to declare beans, it would be nice to let Spring wire obects for you in an Observer fashion,
with a minimal coding effort required. The most minimalistic approach I could think of is to just require developers to
declare their observer beans, and put in place enough machinery to automatically hook them to an Observable provided by
the application. In this example I create a `ObserverBeanPostProcessor` and a `SpringObserver`
tagging interface to identify which beans are actually declaring valid Observers, and register them automatically.

To complete the picture, the `SpringObservable` interface declares which `Observer` class it&#39;s able to notify, thus
leveraging the tagging interface and letting the `ObserverBeanPostProcessor` know which beans to filter and registser.

This enables a software component to provide the desired `SpringObservable` and the `ObserverBeanPostProcessor` beans, where
consumers of such API will be only required to instantiate their `Observer` beans.

Note that `Observers` can be themselves `Observables`, so that you can easily construct chains of beans in which events
will be propagated. As long as you ensure not to form any cyclic graph, of course.

Conclusions
===========

In object oriented languages such as Java, patterns are a powerful tool to apply. The Observer is a neat strategy for
cascading changes on objects, or just to propagate events through a series of processors. All in a clean, loosly coupled
fashion.

The code here is just a proof of concept, not a library which is intended for production use. The concepts and the
implementation are easy enough to be applied in your Spring application without any need for depending on this code.</content><category term="java" /><category term="spring" /><category term="patterns" /><summary>Observers in Spring</summary></entry></feed>
