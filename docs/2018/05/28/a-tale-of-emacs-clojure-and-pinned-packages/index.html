<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>A tale of Emacs, Clojure and pinned packages &#8211; CodeHopper</title> <meta name="description" content=" It’s like trying to pin down a kangaroo on a trampoline.– Sid Waddel"> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://codehopper.nl/img/logo.png"> <meta name="twitter:title" content="A tale of Emacs, Clojure and pinned packages"> <meta name="twitter:description" content=" It’s like trying to pin down a kangaroo on a trampoline.– Sid Waddel"> <meta name="twitter:site" content="@skuro"> <meta name="twitter:creator" content="@skuro"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="A tale of Emacs, Clojure and pinned packages"> <meta property="og:description" content=" It’s like trying to pin down a kangaroo on a trampoline.– Sid Waddel"> <meta property="og:url" content="https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/"> <meta property="og:site_name" content="CodeHopper"> <meta property="og:image" content="https://codehopper.nl/img/logo.png"> <link rel="canonical" href="https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://codehopper.nl/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/default-post.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post-list.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(/img/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post/blackhole.jpg) no-repeat; background-size: cover"> <div class="content"> <a href="/" class="logo"><img src="/img/logo-small.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">A tale of Emacs, Clojure and pinned packages </h1> <ul class="tags"> <li><a href="/tags#clojure">clojure</a></li> <li><a href="/tags#emacs">emacs</a></li> <li><a href="/tags#elisp">elisp</a></li> </ul> <div class="section-line reverse"><a href="/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="/posts.html" title="posts" class="posts-menu-icon"></a> <!-- a title="/projects" class="projects-menu-icon"> <span></span> </a --> <div class="inner-post content"> <nav class="pagination"> <a href="/2017/05/22/void-methods-as-behavior-black-holes/" class="pagination_pager" title="Void methods as behavior black holes ">&lt; Void methods as behavior bl...</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <div class="date-highlight">28 May 2018</div> <blockquote> <p>It’s like trying to pin down a kangaroo on a trampoline. – Sid Waddel</p> </blockquote> <p>If you do any clojure[script] development, <a href="https://static1.squarespace.com/static/5372821be4b0aefc6719057e/t/5aafdd7e562fa73957a7b46b/1521474957333/editor.png?format=1000w">chances are</a> that you do so through Emacs and <a href="https://github.com/clojure-emacs">CIDER</a>. The experience is generally nothing short of <a href="https://ih1.redbubble.net/image.118710403.1747/flat,800x800,075,f.u2.jpg">awesome</a>, but every now and then you bump into some quirks. That was the case for me when the latest CIDER came out, mostly due to how I like to keep my Emacs.</p> <h3 id="tldr"><em>tl;dr</em></h3> <p>CIDER and <code class="highlighter-rouge">clj-refactor</code> have incompatible stable releases for which you need to make sure the latter comes from <code class="highlighter-rouge">melpa-unstable</code></p> <h2 id="stable-vs-unstable">Stable vs unstable</h2> <p>I use Clojure <a href="https://synple.eu/en/index">to pay the bills</a>, and as such I cannot afford myself to walk too much on the bleeding edge. That’s why I made sure all of my Emacs packages come from a slightly trustworthier stream of stable releases:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nb">require</span> <span class="ss">'package</span><span class="p">)</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">package-archives</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"gnu"</span> <span class="o">.</span> <span class="s">"https://elpa.gnu.org/packages/"</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"melpa"</span> <span class="o">.</span> <span class="s">"https://stable.melpa.org/packages/"</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"melpa-unstable"</span> <span class="o">.</span> <span class="s">"https://melpa.org/packages/"</span><span class="p">)))</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">package-archive-priorities</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"melpa"</span> <span class="o">.</span> <span class="mi">50</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"gnu"</span> <span class="o">.</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">(</span><span class="s">"melpa-unstable"</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)))</span>
</code></pre></div> <p>The priorities set on the package archives make sure that released packages (from <a href="https://stable.melpa.org/"><code class="highlighter-rouge">melpa-stable</code></a>) will be installed in place of their unstable snapshots if they exist. Ideally I’d love to remove <code class="highlighter-rouge">melpa-unstable</code> from my configuration, but there are cases in which that’s some necessary evil to keep. Like the reason why I’m writing this up.</p> <h2 id="cider-and-clj-refactor-and-pinning">CIDER and <code class="highlighter-rouge">clj-refactor</code> and pinning</h2> <p>The latest and gratest CIDER (<code class="highlighter-rouge">v0.17.0</code>) earlier in May 2018, while the latest <code class="highlighter-rouge">clj-refactor</code> release is pretty ancient, dating back to June 2017. The two packages are now not compatible, and if you installed both in your Emacs your REPL will fail to start. This has been reported many, many, many times in the <code class="highlighter-rouge">clj-refactor</code> issue tracker, but Java 9 compatibility is <a href="https://github.com/clojure-emacs/clj-refactor.el/issues/403#issuecomment-357631244">holding back</a> any new releases of <code class="highlighter-rouge">clj-refactor</code>, which means we might be waiting quite some time before we can have a stable clojure IDE including refactorings. We need to fiddle around ourselves:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">;; manual package pinning:</span>
<span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'package-pinned-packages</span> <span class="o">'</span><span class="p">(</span><span class="nv">clj-refactor</span> <span class="o">.</span> <span class="s">"melpa-unstable"</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>

<span class="c1">;; or if you're using `use-package' to install packages:</span>
<span class="p">(</span><span class="nb">use-package</span> <span class="nv">clj-refactor</span>
  <span class="ss">:ensure</span> <span class="no">t</span>
  <span class="ss">:pin</span> <span class="s">"melpa-unstable"</span>
  <span class="o">...</span><span class="p">)</span>

</code></pre></div> <p>That’s it. You can now safely upgrade your packages and enjoy your clojure IDE once again.</p> <hr /> <p>As duly noted by <code class="highlighter-rouge">dantheobserver</code> <a href="http://disq.us/p/1svamen">in the comments</a>, <code class="highlighter-rouge">use-package</code> itself is <a href="https://github.com/jwiegley/use-package/issues/602">pending a stable release</a> for some time now. As such, you only have one way to properly pin it, similarly to the first option above:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'package-pinned-packages</span> <span class="o">'</span><span class="p">(</span><span class="nb">use-package</span> <span class="o">.</span> <span class="s">"melpa-unstable"</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</code></pre></div> <p>Happy hacking!</p> <br> <nav class="pagination"> <a href="/2017/05/22/void-methods-as-behavior-black-holes/" class="pagination_pager" title="Void methods as behavior black holes ">&lt; Void methods as behavior bl...</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <a href="https://twitter.com/intent/tweet?text=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://codehopper.nl/2018/05/28/a-tale-of-emacs-clojure-and-pinned-packages/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <br /> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; this.page.identifier = PAGE_IDENTIFIER; }; */ (function() { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = '//skuro.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> <!-- JS --> <script src="/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-6754361-4', 'auto'); ga('send', 'pageview'); </script> </body> </html>
