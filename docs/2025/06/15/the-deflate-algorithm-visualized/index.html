<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>The DEFLATE algorithm, visualized &#8211; CodeHopper</title> <meta name="description" content=" The compression of time one experiences when you‚Äôre a small person underneath this huge avalanche is amazing.‚Äì Conrad Anker"> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/img/logo.svg"> <meta name="twitter:title" content="The DEFLATE algorithm, visualized"> <meta name="twitter:description" content=" The compression of time one experiences when you‚Äôre a small person underneath this huge avalanche is amazing.‚Äì Conrad Anker"> <meta name="twitter:site" content="@skuro"> <meta name="twitter:creator" content="@skuro"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="The DEFLATE algorithm, visualized"> <meta property="og:description" content=" The compression of time one experiences when you‚Äôre a small person underneath this huge avalanche is amazing.‚Äì Conrad Anker"> <meta property="og:url" content="http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/"> <meta property="og:site_name" content="CodeHopper"> <meta property="og:image" content="http://localhost:4000/img/logo.svg"> <link rel="canonical" href="http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="CodeHopper" /> <!-- Favicons --> <link rel="shortcut icon" type="image/svg+xml" href="/img/logo.svg" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/default-post.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post-list.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(/img/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post/compress.jpg) no-repeat; background-size: cover"> <div class="content"> <a aria-label="Go to the homepage" href="/" class="logo"><img alt="Code Hopper small logo" src="/img/logo.svg"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">The DEFLATE algorithm, visualized </h1> <ul class="tags"> <li><a href="/tags#algorithm">algorithm</a></li> <li><a href="/tags#compression">compression</a></li> <li><a href="/tags#deflate">deflate</a></li> <li><a href="/tags#gzipa">gzipa</a></li> </ul> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <div class="section-line reverse"><a href="/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="inner-post content"> <nav class="pagination"> <a href="/2025/02/22/a-not-so-fresh-start/" class="pagination_pager" title="A (not so) fresh start ">&lt; A (not so) fresh start</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <div class="date-highlight">15 Jun 2025</div> <blockquote> <p>The compression of time one experiences when you‚Äôre a small person underneath this huge avalanche is amazing.<br /> ‚Äì Conrad Anker</p> </blockquote> <h1 id="the-deflate-algorithm-visualized">The DEFLATE algorithm, visualized</h1> <p>I‚Äôve recently got on a <a href="https://github.com/skuro/deflate">small journey</a> to implement the <a href="https://datatracker.ietf.org/doc/html/rfc1951">RFC 1951 DEFLATE algorithm</a>. While I‚Äôm not done yet, I got to a good point where I can compress data that‚Äôs accepted by <code class="highlighter-rouge">gzip</code> and <code class="highlighter-rouge">zlib</code> in general. Yay! ü•≥</p> <p>Along the way, I found countless good resources while I was trying to grok the various details of the algorithm itself. I think there‚Äôs plenty of good content on the web except for good-quality visuals to better show what‚Äôs happening under the hood. I‚Äôll try to focus on the visuals here, for me to be able to remember how this algo works in 10 years from now.</p> <h2 id="lempel-ziv-77">Lempel Ziv 77</h2> <p>Let‚Äôs begin with the core idea of the compession algorithm: <a href="https://en.wikipedia.org/wiki/LZ77_and_LZ78#LZ77">LZ77</a>. In order to compress data, we leverage the fact that repetition of (potentially big) chunks of content occur at a rate that it‚Äôs convenient for us, size wize, to just skip writing the repetition verbatim but rather use a sort of ‚Äúpointer‚Äù to a previous occurrence of such chunk. Such ‚Äúpointers‚Äù are provided as a pair of <code class="highlighter-rouge">(length, distance)</code>, meaning that the string of lenght <code class="highlighter-rouge">length</code> starting at the current point is a repetition of the same <code class="highlighter-rouge">length</code> string starting at <code class="highlighter-rouge">distance</code> characters back. For example:</p> <p><img src="/img/post/deflate/lz77_1.svg" alt="LZ77-encoded string" /></p> <p>encodes the following string:</p> <p><img src="/img/post/deflate/lz77_3.svg" alt="LZ77-encoded string" /></p> <p>This is because we encounter a <code class="highlighter-rouge">(length=3, distance=4)</code> pointer at the string index <code class="highlighter-rouge">4</code>. Hence, we go back 4 characters, landing on the <code class="highlighter-rouge">A</code> and repeat the <code class="highlighter-rouge">length=3</code> characters starting from it:</p> <p><img src="/img/post/deflate/lz77_2.svg" alt="LZ77-encoded string" /></p> <p><img src="/img/post/deflate/lz77_3.svg" alt="LZ77-encoded string" /></p> <p>The DEFLATE spec mandates a few extra constraints, for instance that the window within which repetitions are searched is maximum 32k, from which constraints on max <code class="highlighter-rouge">length</code> and <code class="highlighter-rouge">distance</code> values are derived. Also, the repeat <code class="highlighter-rouge">length</code> must be at least 3 characters.</p> <h2 id="visualizing-the-process">Visualizing the process</h2> <p>The following little gimmick (courtesy of <a href="https://claude.ai/">Claude</a> for the most part) shows how the encoding algorithm works when using a search window of 12 characters, step by step. You can provide your own string if you want to see how it would perform:</p> <iframe style="width: 100%" sandbox="allow-same-origin allow-scripts" onload="this.style.height=(this.contentWindow.document.body.scrollHeight+20)+'px';" src="/_pages/embed/lz77.html"></iframe> <p>NOTE: the <code class="highlighter-rouge">Current encoded size</code> calculates each <code class="highlighter-rouge">length, distance</code> pair as length-2, because the compressed output does indeed include dedicated tokens for <code class="highlighter-rouge">length</code> and <code class="highlighter-rouge">distance</code>.</p> <h2 id="huffman-coding">Huffman coding</h2> <p>In the previous paragraph I mentioned the ‚Äúcompressed output‚Äù, but how does that look like in practice? You can imagine that we will output one ‚Äúthing‚Äù per each of the entities</p> <p>In order to answer that question we first need to dive into the magical world of <a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman coding</a>. In Wikipedia terms:</p> <blockquote> <p>a Huffman code is a particular type of optimal prefix code that is commonly used for lossless data compression</p> </blockquote> <p>So in DEFLATE, instead of outputting the character <code class="highlighter-rouge">A</code> we output a specific sequence of bits which represents the Huffman code for the character <code class="highlighter-rouge">A</code>. But what‚Äôs the Huffman code for <code class="highlighter-rouge">A</code>? As for many things in life, it depends.</p> <p>We begin with counting the frequency with which each symbol occurs in our data. As in the previous step, let‚Äôs start with the following LZ77 sequence of symbols:</p> <p><img src="/img/post/deflate/lz77_2.svg" alt="LZ77-encoded string" /></p> <p>Let‚Äôs count occurrences of each symbol. For now,</p> <br> <nav class="pagination"> <a href="/2025/02/22/a-not-so-fresh-start/" class="pagination_pager" title="A (not so) fresh start ">&lt; A (not so) fresh start</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2025/06/15/the-deflate-algorithm-visualized/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <br /> </div> </div> <!-- JS --> <script src="/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> <script data-goatcounter="https://codehopper.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </body> </html>
