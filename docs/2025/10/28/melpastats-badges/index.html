<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Melpastats badges &#8211; CodeHopper</title> <meta name="description" content=" Cersei Lannister: I shall wear this as a badge of honor.Robert Barathon: Wear it in silence or Iâ€™ll honor you again.â€“ George R. R. Martin"> <meta name="keywords" content="emacs, melpa, github, gitlab, badges, clojure, babashka"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/img/logo.svg"> <meta name="twitter:title" content="Melpastats badges"> <meta name="twitter:description" content=" Cersei Lannister: I shall wear this as a badge of honor.Robert Barathon: Wear it in silence or Iâ€™ll honor you again.â€“ George R. R. Martin"> <meta name="twitter:site" content="@skuro"> <meta name="twitter:creator" content="@skuro"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Melpastats badges"> <meta property="og:description" content=" Cersei Lannister: I shall wear this as a badge of honor.Robert Barathon: Wear it in silence or Iâ€™ll honor you again.â€“ George R. R. Martin"> <meta property="og:url" content="http://localhost:4000/2025/10/28/melpastats-badges/"> <meta property="og:site_name" content="CodeHopper"> <meta property="og:image" content="http://localhost:4000/img/logo.svg"> <link rel="canonical" href="http://localhost:4000/2025/10/28/melpastats-badges/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="CodeHopper" /> <!-- Favicons --> <link rel="shortcut icon" type="image/svg+xml" href="/img/logo.svg" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/default-post.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post-list.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(/img/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post/badges.jpg) no-repeat; background-size: cover"> <div class="content"> <a aria-label="Go to the homepage" href="/" class="logo"><img alt="Code Hopper small logo" src="/img/logo.svg"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Melpastats badges </h1> <ul class="tags"> <li><a href="/tags#emacs">emacs</a></li> <li><a href="/tags#melpa">melpa</a></li> <li><a href="/tags#github">github</a></li> <li><a href="/tags#gitlab">gitlab</a></li> <li><a href="/tags#badges">badges</a></li> <li><a href="/tags#clojure">clojure</a></li> <li><a href="/tags#babashka">babashka</a></li> </ul> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <div class="section-line reverse"><a href="/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="inner-post content"> <nav class="pagination"> <a href="/2025/02/22/a-not-so-fresh-start/" class="pagination_pager" title="A (not so) fresh start ">&lt; A (not so) fresh start</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <div class="date-highlight">28 Oct 2025</div> <blockquote> <p>Cersei Lannister: I shall wear this as a badge of honor.<br /> Robert Barathon: Wear it in silence or Iâ€™ll honor you again.<br /> â€“ George R. R. Martin</p> </blockquote> <h1 id="tldr">TL;DR</h1> <p>Have a project called <code class="highlighter-rouge">fizzbuzz</code> that you deploy on <a href="https://melpa.org">MELPA</a>? Add the following snippet to your <code class="highlighter-rouge">README.md</code> in order to add a download count badge:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nv">![downloads</span><span class="p">](</span><span class="sx">https://melpastats-2761cf.gitlab.io/badges/fizzbuzz.svg</span><span class="p">)</span>](http://melpa.org/#/fizzbuzz)
</code></pre></div></div> <p>or if <code class="highlighter-rouge">org-mode</code> is your poison:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nv">[https://melpa.org/#/fizzbuzz</span><span class="p">][</span><span class="ss">https://melpastats-2761cf.gitlab.io/badges/fizzbuzz-badge.svg</span><span class="p">]</span>]

</code></pre></div></div> <p>It looks like this (taken from my own project <a href="https://github.com/skuro/plantuml-mode"><code class="highlighter-rouge">plantuml-mode</code></a>):</p> <p><a href="http://melpa.org/#/plantuml-mode"><img src="https://melpastats-2761cf.gitlab.io/badges/plantuml-mode-badge.svg" alt="downloads" /></a></p> <h1 id="the-quest">The quest</h1> <p>I was recently busy with some cleanup and improvements of my open source projects, which resulted into <a href="https://github.com/skuro/deflate">deflate</a>, a pure elisp implementation of the Deflate compression algorithm. After a few day that the package was published on MELPA, I was curious to check whether it was being downloaded (mostly as a sidecar to <code class="highlighter-rouge">plantuml-mode</code>, which is the only thing in the world that depends on it currently).</p> <p>Fortunately enough, MELPA publishes your download counts and â€“ oh boy! The tears in my eyes when I did see some downloads action there! I <em>needed</em> to boast about it and showcase the download count prominently in the project <code class="highlighter-rouge">README.org</code>. I needed badges.</p> <h1 id="eat-your-own-parenthesis">Eat your own parenthesis</h1> <p>Iâ€™m sure there are million ways to make a badge / shield happen. Heck, maybe someone else already did it and I havenâ€™t found it (spoiler: I havenâ€™t searched ğŸ˜±). Anyways I was craving some custom coding and so it was decided: Iâ€™ll make a new project called <a href="https://gitlab.com/codehopper-bv/melpastats"><code class="highlighter-rouge">melpastats</code></a>. What it offers:</p> <ul> <li>ğŸ–¼ï¸ pregenerated <code class="highlighter-rouge">.svg</code> badges with the download count</li> <li>ğŸ“¦ assets are hosted on Gitlab pages</li> <li>â²ï¸ refresh the download counts every 6 hours</li> <li>ğŸ’„ different <a href="https://gitlab.com/codehopper-bv/melpastats/-/blob/main/src/melpastats/update.bb#L22">background colors</a> depending on the total downloads count</li> <li><del>ğŸ“ˆ full history of the download count updates</del> (maybe, in the far future)</li> </ul> <p>I went for a simple <a href="https://babashka.org/"><code class="highlighter-rouge">babashka</code></a> script, which uses <a href="https://github.com/adam-james-v/svg-clj"><code class="highlighter-rouge">svg-clj</code></a> to render the actual image from Hiccup syntax. For the uninitiated, hereâ€™s how it looks like:</p> <div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="no">:svg</span><span class="w"> </span><span class="p">{</span><span class="no">:xmlns</span><span class="w"> </span><span class="s">"http://www.w3.org/2000/svg"</span><span class="w">
           </span><span class="no">:width</span><span class="w"> </span><span class="n">full-width</span><span class="w">
           </span><span class="no">:height</span><span class="w"> </span><span class="n">height</span><span class="w">
           </span><span class="no">:role</span><span class="w"> </span><span class="s">"img"</span><span class="w">
           </span><span class="no">:aria-label</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="s">"MELPA: "</span><span class="w"> </span><span class="n">package-name</span><span class="p">)}</span><span class="w">
     </span><span class="p">[</span><span class="no">:title</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="s">"MELPA: "</span><span class="w"> </span><span class="n">package-name</span><span class="p">)]</span><span class="w">
     </span><span class="c1">;; ...</span><span class="w">
     </span><span class="p">]</span><span class="w">
</span></code></pre></div></div> <p>You can see the full <a href="https://gitlab.com/codehopper-bv/melpastats/-/blob/main/src/melpastats/update.bb?ref_type=heads#L31">hiccup</a> stuff in the sources of course. The overall process is intentionally dumb as a rock, namely:</p> <ol> <li>gitlab CI: download and parse the <a href="https://melpa.org/archive.json">packages list</a> and <a href="https://melpa.org/download_counts.json">download counts</a> JSON files</li> <li>babashka: for each package, render the actual <code class="highlighter-rouge">SVG</code> file using its download count</li> <li>ensure the folder with the SVGs is published in Gitlab pages</li> </ol> <p>It took just a few hours of non-continuous work to make that happen. Now itâ€™s live for a month or two and Iâ€™m confident enough with it that itâ€™s time for this post to happen. Hope itâ€™s of any use for anyone out there.</p> <p>Bye bye ğŸ‡¬ğŸ‡§ / tot ziens ğŸ‡³ğŸ‡± / a si biri (alas, no emoji for <a href="https://en.wikipedia.org/wiki/Sardinian_language">Sardinian</a> :sadface:)</p> <br> <nav class="pagination"> <a href="/2025/02/22/a-not-so-fresh-start/" class="pagination_pager" title="A (not so) fresh start ">&lt; A (not so) fresh start</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2025/10/28/melpastats-badges/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <br /> </div> </div> <!-- JS --> <script src="https://giscus.app/client.js" data-repo="CodeHopperNL/codehopper.nl" data-repo-id="MDEwOlJlcG9zaXRvcnk3NTE3NjIwNg==" data-category="Announcements" data-category-id="DIC_kwDOBHsZDs4CrhvA" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="noborder_light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script> <!-- JS --> <script src="/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> <script data-goatcounter="https://codehopper.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </body> </html>
