<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Alfresco and LDAP sync lock my Admin no more! &#8211; CodeHopper</title> <meta name="description" content="On the custom Alfresco Enterprise project I’m working we use LDAP sync to import users from a Novell eDirectory server[1]. Now, it happened from time to time that the user Alfresco binds itself with, i.e. the LDAP admin user, got locked in eDirectory as a “Intrusion prevention” mechanism or something like that."> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/img/logo.png"> <meta name="twitter:title" content="Alfresco and LDAP sync lock my Admin no more!"> <meta name="twitter:description" content="On the custom Alfresco Enterprise project I’m working we use LDAP sync to import users from a Novell eDirectory server[1]. Now, it happened from time to time that the user Alfresco binds itself with, i.e. the LDAP admin user, got locked in eDirectory as a “Intrusion prevention” mechanism or something like that."> <meta name="twitter:site" content="@skuro"> <meta name="twitter:creator" content="@skuro"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Alfresco and LDAP sync lock my Admin no more!"> <meta property="og:description" content="On the custom Alfresco Enterprise project I’m working we use LDAP sync to import users from a Novell eDirectory server[1]. Now, it happened from time to time that the user Alfresco binds itself with, i.e. the LDAP admin user, got locked in eDirectory as a “Intrusion prevention” mechanism or something like that."> <meta property="og:url" content="http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/"> <meta property="og:site_name" content="CodeHopper"> <meta property="og:image" content="http://localhost:4000/img/logo.png"> <link rel="canonical" href="http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="CodeHopper" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/default-post.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post-list.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(/img/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post/baby-ninja.jpg) no-repeat; background-size: cover"> <div class="content"> <a aria-label="Go to the homepage" href="/" class="logo"><img alt="Code Hopper small logo" src="/img/logo-small.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Alfresco and LDAP sync lock my Admin no more! </h1> <ul class="tags"> <li><a href="/tags#alfresco">alfresco</a></li> </ul> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <div class="section-line reverse"><a href="/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="inner-post content"> <nav class="pagination"> <a href="/2009/04/05/quick-fix-for-alsa-error-cannot-find-the-slot-for-index-0/" class="pagination_pager" title="Quick fix for ALSA error: cannot find the slot for index 0 ">&lt; Quick fix for ALSA error: c...</a> <a href="/2009/10/07/how-to-configure-alsa-for-your-asus-p5k-on-linux-mint/" class="pagination_pager" title="(how to configure Alsa for your Asus P5K on) Linux Mint ">(how to configure Alsa for ... &gt;</a> </nav> <div class="date-highlight">15 Sep 2009</div> <p>On the custom <a href="http://www.alfresco.com">Alfresco Enterprise</a> project I’m working we use LDAP sync to import users from a Novell eDirectory server[<a href="#note-1">1</a>]. Now, it happened from time to time that the user Alfresco binds itself with, i.e. the LDAP admin user, got locked in eDirectory as a “Intrusion prevention” mechanism or something like that.</p> <p>The LDAP sysadmin said we were guilty of providing wrong credentials too many times when logging in. Which is weird, since most of the time the LDAP sync went well, which meant that either that sysadmin was seldom changing back and forth the Admin credentials or something Evil™ was going on under the hood. I personally feared for the latter, but let the issue wait a bit, since staging environments seemed to work just fine.</p> <p>Then, when my dev team grew up with three more people, the issue worsened terribly, with the admin account locked almost any hour. I really started to get bothered by it, and did some investigations.</p> <p>It turned out, it was all working “by design”, in the sense that yes, our Alfresco was providing wrong credentials and yes, the admin account was properly configured. This is how it went.</p> <p>To be 100% sure our Alfresco configuration was correct, apart from checking every configuration file from here to eternity, I wanted to sniff the network connection to the LDAP server. When networked systems fail to work together, I always feel like I <strong>need</strong> raw network data.</p> <p>Made a <a href="http://www.google.com/search?q=socat"><strong>socat</strong></a> tunnel[<a href="#note-2">2</a>] to look at data BEFORE it entered the encrypted VPN connection, started Alfresco and waited. And, eventually, got it: I expected one bind connection request, I got more. Plus, the first three or four attempts were using almost random user accounts, while the last showed the known LDAP admin user name and the wrong password! WTF?</p> <p>A closer look at the <a href="http://svn.alfresco.com/repos/alfresco-open-mirror/alfresco/HEAD/root/projects/repository/source/java/org/alfresco/repo/security/authentication/ldap/LDAPInitialDirContextFactoryImpl.java">Alfresco LDAP connector</a> solved the mistery. Here’s an excerpt from that code:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // Correct principal invalid password
 env = new Hashtable(initialDirContextEnvironment.size());
 env.putAll(initialDirContextEnvironment);
 env.put(Context.SECURITY_CREDENTIALS, "sdasdasdasdasd123123123");
 try
 {

     new InitialDirContext(env);

     throw new AuthenticationException(
             "The ldap server at "
                     + env.get(Context.PROVIDER_URL)
                     + " falls back to use anonymous bind for a known principal if  invalid security credentials are presented. This is not supported.");
 }
</code></pre></div></div> <p>That’s it: Alfresco performs intentionally a number of connections that are supposed to fail, in order to infer some LDAP server configurations. The code presented here above is what made eDirectory lock the admin user: when our 5~6 developer environments started up, almost simultaneously at the morning, they performed too many wrong login attempts with the correct user name in a row before the first one eventually started using both the valid username <strong>and</strong> the correct password.</p> <p>Setting up the allowed failed logins on eDirectory for the local testing environment, finally, solved this hidden and tedious issue. Still unclear if the Alfresco approach is really a smart one, due to some limitations of the LDAP handshake protocol I’m not aware of (well, I’m not that LDAP expert, after all) or such intentionally failing logins can/should be deleted/changed. What do you think?</p> <p>[<a name="note-1">1</a>] Here Alfresco happens to be MultiTenant, but still we are able to import users&amp;groups from the Directory. Which has been my very first successful customization task as an Alfresco dev :)</p> <p>[<a name="note-2">2</a>] I’ll eventually end up using socat for brushing my teeth, I guess</p> <br> <nav class="pagination"> <a href="/2009/04/05/quick-fix-for-alsa-error-cannot-find-the-slot-for-index-0/" class="pagination_pager" title="Quick fix for ALSA error: cannot find the slot for index 0 ">&lt; Quick fix for ALSA error: c...</a> <a href="/2009/10/07/how-to-configure-alsa-for-your-asus-p5k-on-linux-mint/" class="pagination_pager" title="(how to configure Alsa for your Asus P5K on) Linux Mint ">(how to configure Alsa for ... &gt;</a> </nav> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/2009/09/15/alfresco-and-ldap-sync-lock-my-admin-no-more/" class="btn btn_hn" title="Share on Hacker News"><i class="fa fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a> <br /> </div> </div> <!-- JS --> <script src="/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> <script data-goatcounter="https://codehopper.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </body> </html>
