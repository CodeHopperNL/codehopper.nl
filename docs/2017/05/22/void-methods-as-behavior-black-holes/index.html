<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Void methods as behavior black holes &#8211; CodeHopper</title> <meta name="description" content=" This post could have been titled ‘Void methods considered harmful’,if ‘considered harmful’ essays weren’tconsidered harmful themselves. Oh welp."> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://codehopper.nl/img/logo.png"> <meta name="twitter:title" content="Void methods as behavior black holes"> <meta name="twitter:description" content=" This post could have been titled ‘Void methods considered harmful’,if ‘considered harmful’ essays weren’tconsidered harmful themselves. Oh welp."> <meta name="twitter:site" content="@skuro"> <meta name="twitter:creator" content="@skuro"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Void methods as behavior black holes"> <meta property="og:description" content=" This post could have been titled ‘Void methods considered harmful’,if ‘considered harmful’ essays weren’tconsidered harmful themselves. Oh welp."> <meta property="og:url" content="https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/"> <meta property="og:site_name" content="CodeHopper"> <meta property="og:image" content="https://codehopper.nl/img/logo.png"> <link rel="canonical" href="https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://codehopper.nl/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/default-post.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post-list.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(/img/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/img/post/blackhole.jpg) no-repeat; background-size: cover"> <div class="content"> <a href="/" class="logo"><img src="/img/logo-small.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Void methods as behavior black holes </h1> <ul class="tags"> <li><a href="/tags#java">java</a></li> <li><a href="/tags#clean code">clean code</a></li> </ul> <div class="section-line reverse"><a href="/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="/posts.html" title="posts" class="posts-menu-icon"></a> <!-- a title="/projects" class="projects-menu-icon"> <span></span> </a --> <div class="inner-post content"> <nav class="pagination"> <a href="/2016/12/05/yet-another-agile-is-dead-post/" class="pagination_pager" title="Yet another agile is dead post ">&lt; Yet another agile is dead post</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <div class="date-highlight">22 May 2017</div> <blockquote> <p>This post could have been titled ‘Void methods considered harmful’, if ‘considered harmful’ essays weren’t <a href="http://meyerweb.com/eric/comment/chech.html">considered harmful themselves</a>. Oh welp.</p> </blockquote> <p>Void methods are ubiquitous in most Object Oriented codebases. A direct consequence of mutable state or I/O somewhere in your runtime, you can wrap any behavior that functional programming zealots would call <a href="https://en.wikipedia.org/wiki/Pure_function#Impure_functions_in_pure_expressions">impure</a>, which in principle has no meaningful return value. One common example is during application bootstrap, e.g. in Java:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span> <span class="n">MyClass</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

<span class="c1">// ...</span>

<span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">executorService</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span>
            <span class="k">this</span><span class="o">,</span>
            <span class="mi">0</span><span class="o">,</span>
            <span class="mi">500</span><span class="o">,</span>
            <span class="n">TimeOut</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div> <p>The above is supposedly fine, but public void methods, and especially a proliferation of them in a given codebase, are an evident code smell. Even when coding in Object Oriented style.</p> <h1 id="your-public-interface">Your <code class="highlighter-rouge">public</code> interface</h1> <p>Public methods are meant for your class <a href="https://en.wikipedia.org/wiki/Class-responsibility-collaboration_card">collaborators</a> to consume, they are the gateway to your class functionality. As such, they should be as clear as concise as possible, offering the minimal surface area needed to enable your class behaviors. One major, self-documenting part of any function definition is naturally its return type.</p> <p>Lets start from the previous example:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span> <span class="n">MyClass</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

<span class="c1">// ...</span>

<span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">executorService</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span>
            <span class="k">this</span><span class="o">,</span>
            <span class="mi">0</span><span class="o">,</span>
            <span class="mi">500</span><span class="o">,</span>
            <span class="n">TimeOut</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div> <p>Our class is likely receiving some sort of <code class="highlighter-rouge">executorService</code> instance at construction time, possibly obtained from some <a href="http://imgur.com/iZcUNxH">dependency injection</a> glue code, after which a worker schedule is started. The likelihood of client code needing to explicitly call <code class="highlighter-rouge">init()</code> is typically very low. This suggests that our <code class="highlighter-rouge">@PostConstruct</code> method should probably have a more restrictive visibility, maybe <code class="highlighter-rouge">private</code> or <code class="highlighter-rouge">protected</code>, and that would be the end of it.</p> <p>But, is it really?</p> <h1 id="testability">Testability</h1> <p>Let’s say we want to actually test the shutdown behavior of our worker threads, typically a tricky thing to do. What you want to do is something along the lines of:</p> <div class="highlighter-rouge"><pre class="highlight"><code>
<span class="c1">// changed code from the original MyClass file:</span>
<span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">executorService</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(</span>
            <span class="k">this</span><span class="o">,</span>
            <span class="mi">0</span><span class="o">,</span>
            <span class="mi">500</span><span class="o">,</span>
            <span class="n">TimeOut</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">public</span> <span class="nf">testExecutorShutdown</span><span class="p">(</span><span class="o">){</span>
    <span class="n">ScheduledExecutorService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">();</span>
    <span class="n">MyClass</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="o">(</span><span class="n">service</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span> <span class="c1">// executorService, enabled</span>
    <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">scheduled</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
    <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="n">scheduled</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span> <span class="c1">// throws exception</span>
<span class="o">}</span>
</code></pre></div> <p>The above test code tests that the scheduled action terminates within 1 second (or two scheduled iterations) from the executor shutdown. Such a test relies on accessing the future object returned by the init method.</p> <h1 id="self-documenting">Self documenting</h1> <blockquote> <p>it is Human perception that is sealed off behind their current consciousness horizon</p> <p>– <em>Elia Wise</em></p> </blockquote> <p>The change we made to the <code class="highlighter-rouge">init()</code> method enabled the behavioral test, but introduced an important side effect: the <code class="highlighter-rouge">ScheduledFuture</code> object is now part of <code class="highlighter-rouge">MyClass</code> public interface, meaning that now any client code is able to interact with it. Whether this is a desirable property really depends on the use case <code class="highlighter-rouge">MyClass</code> is designed to support, and probably you want to encapsulate the <code class="highlighter-rouge">ScheduledFuture</code> in a more friendly class that e.g. only exposes something like <code class="highlighter-rouge">bool isDone()</code>.</p> <p>In any case, keeping the above <code class="highlighter-rouge">init</code> method void would always end up in your client code (or developer glancing at the <code class="highlighter-rouge">init</code> signature using his/her IDE) being oblivious of what <code class="highlighter-rouge">MyClass.init()</code> is really doing. Just look at the different signatures, and think of yourself coding against each of them:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">init</span><span class="o">()</span>
</code></pre></div> <p>the latter one will save you a brain cycle every time you need to use it, as it clearly states its produced effects without having to look at the code or at a deeper level of documentation.</p> <h1 id="do-one-thing-and-do-it-well">Do one thing and do it well</h1> <p>Sticking to the idea that your function returns a single value to explicitly states its behavior is obviously impossible when your function does more than one thing at a time. Fortunately, that by itself is a <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">code smell</a>, and by treating your return type as the existential purpose of your functions you make it one step weirder to violate the principle.</p> <h1 id="conclusions">Conclusions</h1> <p>Be nice to your future self and in general to all developers using your code and never hide such a valuable piece of information like your return value in your public API, never again.</p> <p>Hugs &amp; kisses, c.</p> <br> <nav class="pagination"> <a href="/2016/12/05/yet-another-agile-is-dead-post/" class="pagination_pager" title="Yet another agile is dead post ">&lt; Yet another agile is dead post</a> <a href="#" class="pagination_pager disabled">next</a> </nav> <a href="https://twitter.com/intent/tweet?text=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://codehopper.nl/2017/05/22/void-methods-as-behavior-black-holes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <br /> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; this.page.identifier = PAGE_IDENTIFIER; }; */ (function() { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = '//skuro.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> <!-- JS --> <script src="/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-6754361-4', 'auto'); ga('send', 'pageview'); </script> </body> </html>
